{%- macro traefik_labels(name, port, set_enabled=true) -%}    
{%- if set_enabled -%}
# Enable traefik to proxy this service
- 'traefik.enable=true'
{%- endif -%}

# Traefik HTTP -> HTTPS
- 'traefik.http.routers.{{ name }}.rule=Host(`{{ name }}.{{ fqdn }}`)'
- 'traefik.http.routers.{{ name }}.entrypoints=web'
- 'traefik.http.routers.{{ name }}.middlewares=redirect@file'
    
# Traefik HTTPS
- 'traefik.http.routers.{{ name }}-secured.rule=Host(`{{ name }}.{{ fqdn }}`)'
- 'traefik.http.routers.{{ name }}-secured.entrypoints=web-secured'
- 'traefik.http.routers.{{ name }}-secured.tls.certresolver=default'
- 'traefik.http.services.traefik.loadbalancer.server.port={{ port }}'
{%- endmacro -%}

{%- macro restart_policy() -%}
restart_policy:
  condition: {{ docker_restart_policy_condition }}
  delay: {{ docker_restart_policy_delay }}
  max_attempts: {{ docker_restart_policy_max_attempts }}
  window: {{ docker_restart_policy_window }}
{%- endmacro -%}